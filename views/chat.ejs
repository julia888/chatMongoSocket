<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"/>
    <!--<link rel="stylesheet" href="../../public/css/app.css"/>-->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
</head>
<body>

<section class="container">
    <nav class="navbar navbar-default" role="navigation">
        <ul class="nav navbar-nav">
            <li><a href="/">Главная</a></li>

        </ul>
        <p>chat here</p>
        <ul class="nav navbar-nav navbar-right">
            <% if (user){ %>
                <a href="" onclick="$(document.body).append($('<form method=POST action=/logout>'));$('form').submit();return false">Выйти</a>
            <% } else { %>
                <li><a href="/login">Войти</a></li>
            <% } %>
        </ul>
    </nav>
</section>
<p id="name"><%=user.get("username")%></p>
<div id="room">
    <ul></ul>
    <form>
        <input type="text" class="form-control" autocomplete="off" autofocus placeholder="Message...">
    </form>
</div>
<script>
    function setLS(){
        let user =document.getElementById('name').innerText;
        localStorage.setItem('logo', user);
        var ls =localStorage.getItem('logo');
        return ls;
    }
    setLS();
</script>
<script src="/socket.io/socket.io.js"></script>
<script>
    var ls =setLS();
    var socket = io.connect();

    var form = $('#room form');
    var ul = $('#room ul');

    form.submit(function () {

        var input = $(this).find(':input');
        var text = input.val();

        var allText = ls +" > " + text;

        socket.emit('message', allText, function (data) {
            $('<li>', {text: allText}).appendTo(ul);
        });
        $('#room>form>input').val('');
        return false;
    });

    socket.on('message', function (text) {
        $('<li>', {text: text}).appendTo(ul);
    });

</script>

</body>
</html>

